<!DOCTYPE html>
<html lang="zh-TW">
<head>
 <script src="/js/header.js" defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å±æ±å¤ªå¹³æ´‹ç™¾è²¨ç·šä¸ŠDM</title>

  <!-- ç«™å…§ä¸»é¡Œæ¨£å¼ + æœ¬é æ¨£å¼ -->
  <link rel="stylesheet" href="/css/brands.css" />
  <link rel="stylesheet" href="/css/dm.css" />
  <link rel="stylesheet" href="/css/header.css">

  <!-- jQuery & turn.jsï¼ˆå¦‚éœ€å…§ç¶²ï¼Œè«‹æ”¹æˆæœ¬åœ° /js/turn.min.jsï¼‰ -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/blasten/turn.js@master/turn.min.js"></script>
</head>
<body>
<div id="dm-app">
  <div class="dm-header">
    <h1 class="dm-title">å±æ±å¤ªå¹³æ´‹ç™¾è²¨ç·šä¸ŠDM</h1>
  </div>

  <!-- DM åˆ— + å›é¦–é ï¼ˆä½èª¿è† å›ŠæŒ‰éˆ•ï¼Œæ¨£å¼åœ¨ dm.css çš„ .dm-homeï¼‰ -->
  <div class="dm-tabs" role="tablist" aria-label="DM é¸æ“‡">
    <button class="dm-tab" role="tab" aria-selected="true"  data-book="a">APPæœƒå“¡é™å®š å‰æ™‚äº«æ¨‚</button>
    <button class="dm-tab" role="tab" aria-selected="false" data-book="b">ç§‹æ—¥æ”¶è—å®¶</button>
    <button class="dm-tab" role="tab" aria-selected="false" data-book="c">æœˆä¾†æ‚…å¥½ ä¸­ç§‹åœ˜è³¼</button>
    <button class="dm-tab" role="tab" aria-selected="false" data-book="d">æ–°é®®äººåˆç™»å ´</button>
    <button class="dm-tab" role="tab" aria-selected="false" data-book="e">å©šç¦®å°ˆåˆŠ</button>
    <a class="dm-home" href="/" id="btn-home">å›é¦–é </a>
  </div>

  <div class="dm-shell">
    <section class="dm-info" id="dm-info"></section>

    <section class="dm-book-wrap">
      <div id="dm-viewport" class="dm-book-viewport">
        <button class="nav-btn nav-left" id="nav-left" aria-label="ä¸Šä¸€é ">â€¹</button>
        <button class="nav-btn nav-right" id="nav-right" aria-label="ä¸‹ä¸€é ">â€º</button>
        <button class="nav-zoom" id="nav-zoom" aria-label="å…¨è¢å¹•">ğŸ”</button>
        <div id="dm-book"></div>
      </div>
      <div class="dm-dots" id="dm-dots"></div>
    </section>
  </div>
</div>

<script>
/* åœ–ç‰‡æ ¹ç›®éŒ„ï¼ˆä¾ä½ çš„è¦æ±‚æ”¹ç‚ºä¸Šå±¤ï¼‰ */
const BASE = "../images/dm/";

/* äº”æœ¬ DM è³‡æ–™ */
const books = {
  a:{folder:"a",pages:[1,2,3,4,5],ext:"png",title:"APPæœƒå“¡é™å®š å‰æ™‚äº«æ¨‚",period:"8/14(å››)~9/9(äºŒ)",desc:[]},
  b:{folder:"b",pages:[1,2,3,4,5],ext:"png",title:"ç§‹æ—¥æ”¶è—å®¶",period:"9/11(å››)~9/30(äºŒ)",desc:[]},
  c:{folder:"c",pages:[1,2],ext:"png",title:"æœˆä¾†æ‚…å¥½ ä¸­ç§‹ç¯€ç¾é£Ÿåœ˜è³¼",period:"",desc:[
      "ç¬¬ä¸€æ³¢é è³¼æ™‚é–“: 8/22(äº”)~9/21(æ—¥)ï¼Œå–è²¨: 9/26(äº”)~9/28(æ—¥) 14:00~20:00",
      "ç¬¬äºŒæ³¢é è³¼æ™‚é–“: 9/22(ä¸€)~9/28(æ—¥)ï¼Œå–è²¨: 10/3(äº”)~10/6(ä¸€) 14:00~20:00",
      "åœ˜è³¼åŠ ç¢¼è´ˆï¼šç•¶æ—¥è³¼è²·åœ˜è³¼å•†å“ç´¯è¨ˆæ»¿1000å…ƒï¼ŒåŠ è´ˆå‰åˆ©å¡é»æ•¸100é»ï¼ˆæ¯å¡ä¹™æ¬¡ï¼‰ã€‚",
      "æ­¡è¿æ–°æœ‹å‹ï¼šé¦–æ¬¡ä¸‹è¼‰ APP ä¸¦è¨»å†Šæˆæœƒå“¡ï¼Œè´ˆé¤é£²é›»å­åˆ¸100å…ƒï¼ˆæ¯æœƒå“¡ä¹™ä»½ï¼›èˆŠå¡å‹æ­¸æˆ¶ä¸é©ç”¨ï¼‰ã€‚"
  ]},
  d:{folder:"d",pages:[1,2],ext:"png",title:"æ–°é®®äººåˆç™»å ´",period:"å³æ—¥èµ·~9/30(äºŒ)",desc:[
      "å°ˆæ¡ˆæ´½å°å¹«æ‰‹ï¼š08-7325666#580ã€‚",
      "æŒç•¢æ¥­è­‰æ›¸ï¼ˆå¯å½±æœ¬ï¼‰æˆ–ä¼æ¥­è­˜åˆ¥è­‰ï¼åç‰‡ï¼Œè³¼è²·å°ˆåˆŠä¸åŒæ«ƒä½ä»»å…©å“ä¸”æ»¿3000å…ƒï¼Œè´ˆé›»å­åˆ¸100å…ƒï¼›æ»¿6000å…ƒè´ˆ200å…ƒï¼Œä»¥æ­¤é¡æ¨ã€‚",
      "è©³æƒ…ä»¥åº—å…§å…¬å‘Šç‚ºä¸»ï¼›é‡ç‰¹æ®Šæª”æœŸå›é¥‹æ“‡ä¸€ã€‚"
  ]},
  e:{folder:"e",pages:Array.from({length:18},(_,i)=>i+1),ext:"png",title:"å©šç¦®å°ˆåˆŠ",period:"7/1(äºŒ)~9/30(äºŒ)",desc:[
      "å©šç¦®å°ˆæ¡ˆæ´½å©šç¦®å°ç§˜æ›¸ï¼š08-7325666#580ã€‚",
      "æŒçµå©šç›¸é—œè­‰ä»¶ + ç•¶æ—¥è³¼è²·å°ˆåˆŠä¸åŒæ«ƒä½ä»»å…©å“ä¸”æ»¿20000å…ƒï¼Œè´ˆå©šç¦®ç¥è³€é‡‘é›»å­åˆ¸1000å…ƒï¼›æ»¿40000å…ƒè´ˆ2000å…ƒï¼ˆåŒä¸€å¡å‹é™ä¹™æ¬¡ï¼‰ã€‚",
      "è©³æƒ…ä»¥åº—å…§å…¬å‘Šç‚ºä¸»ï¼›é‡ç‰¹æ®Šæª”æœŸå›é¥‹æ“‡ä¸€ã€‚"
  ]}
};

(function($){
  let currentKey = "a";
  const $book = $("#dm-book");
  const $viewport = $("#dm-viewport");
  const $dots = $("#dm-dots");
  const $info = $("#dm-info");
  let building = false; // é˜²æ­¢é‡å…¥ï¼ˆresize/fullscreen/tabs åˆ‡æ›ï¼‰

  function buildInfo(key){
    const b = books[key];
    const lines = [`<h3>${b.title}</h3>`, b.period?`<p><strong>æ´»å‹•æœŸé–“ï¼š</strong>${b.period}</p>`:""];
    if (b.desc?.length){
      lines.push("<hr style='border:none;border-top:1px dashed #ddd;margin:.5rem 0'/>");
      b.desc.forEach(t=>lines.push(`<p>${t}</p>`));
    }
    $info.html(lines.join(""));
  }

  function buildDots(key){
    const total = books[key].pages.length;
    $dots.html("");
    for(let i=1;i<=total;i++){
      const dot=document.createElement("div");
      dot.className="dm-dot";
      dot.addEventListener("click",()=> safeGoPage(i));
      $dots.append(dot);
    }
  }
  function updateDots(key,pageIdx){
    const total = books[key].pages.length;
    const dots = $dots.children().toArray();
    const idx = Math.min(Math.max((pageIdx|0)-1,0), total-1);
    dots.forEach((el,i)=> el.classList.toggle("active", i===idx));
  }

  function buildBook(key){
    if (building) return;
    building = true;
    if (!$.fn.turn){ alert("turn.js è¼‰å…¥å¤±æ•—ï¼Œè«‹æ”¹ç”¨æœ¬åœ° /js/turn.min.js"); building=false; return; }

    const b = books[key];
    const pages = [...b.pages].sort((x,y)=>x-y);
    const total = pages.length;

    try{ if ($book.data("inited")) $book.turn("destroy"); }catch(e){}
    $book.empty();

    // å»ºç«‹æ‰€æœ‰é é¢
    $book.html(pages.map(n=>{
      const src = `${BASE}${b.folder}/${n}.${b.ext}`;
      return `<div class="page"><img alt="p${n}" loading="lazy" src="${src}" onerror="this.style.opacity=.3"/></div>`;
    }).join(""));

    // æ˜ç¢ºæŒ‡å®š pages èˆ‡åˆå§‹ pageï¼Œé¿å… "is not a page for range"
    $book.turn({
      width: $viewport.width(),
      height: $viewport.height(),
      display: "single",
      pages: total,
      page: 1,
      autoCenter: true,
      acceleration: true,
      gradients: true,
      elevation: 50,
      when:{ turned:(_,page)=> updateDots(key,page) }
    });
    $book.data("inited", true);

    buildDots(key);
    updateDots(key, 1);

    // ç­‰ layout å®Œæˆå†é‡˜ä¸€æ¬¡ç¬¬ 1 é ï¼Œé¿å…åˆå§‹åŒ–ç«¶æ…‹
    requestAnimationFrame(()=>{ safeGoPage(1); building=false; });
  }

  function clampPage(p){
    let total=1;
    try{ total = $book.turn("pages")||1; }catch(e){ total=1; }
    p = p|0; if (!p) p = 1;
    return Math.min(Math.max(1,p), total);
  }
  function safeGoPage(n){
    if (!$book.data("inited")) return;
    try{ $book.turn("page", clampPage(n)); }catch(e){}
  }
  function next(){ if ($book.data("inited")) try{ $book.turn("next"); }catch(e){} }
  function prev(){ if ($book.data("inited")) try{ $book.turn("previous"); }catch(e){} }
  function first(){ safeGoPage(1); }

  function redoLayout(){
    if (building || !$book.data("inited")) return;
    building = true;
    let page = 1;
    try{ page = clampPage($book.turn("page")); }catch(e){ page = 1; }
    buildBook(currentKey);
    requestAnimationFrame(()=>{ safeGoPage(page); building=false; });
  }

  function switchBook(key){
    if (currentKey===key) return;
    currentKey = key;
    document.querySelectorAll(".dm-tab").forEach(el=> el.setAttribute("aria-selected", String(el.dataset.book===key)));
    buildInfo(key);
    buildBook(key);
    first();
  }

  // å¸¸é§å·¦å³å°è¦½
  $("#nav-left").on("click", prev);
  $("#nav-right").on("click", next);

  // å…¨è¢å¹•åˆ‡æ›
  $("#nav-zoom").on("click", ()=>{
    const el = $viewport.get(0);
    if (!document.fullscreenElement){ el.requestFullscreen?.(); }
    else{ document.exitFullscreen?.(); }
  });
  document.addEventListener("fullscreenchange", ()=> setTimeout(redoLayout, 60));

  // éµç›¤ & è§¸æ§
  document.addEventListener("keydown", e=>{
    if (["ArrowRight","PageDown"].includes(e.key)) next();
    else if (["ArrowLeft","PageUp"].includes(e.key)) prev();
    else if (e.key==="Home") first();
  });
  (function enableSwipe(){
    let startX=0;
    $viewport.on("touchstart", e=> startX = e.originalEvent.touches[0].clientX);
    $viewport.on("touchend", e=>{
      const endX = e.originalEvent.changedTouches[0].clientX;
      const dx = endX - startX;
      if (Math.abs(dx)>40) (dx<0 ? next() : prev());
    });
  })();

  // Tabs
  document.querySelectorAll(".dm-tab").forEach(btn=>{
    btn.addEventListener("click", ()=> switchBook(btn.dataset.book));
  });

  // åˆå§‹åŒ–
  $(function(){
    buildInfo(currentKey);
    buildBook(currentKey);
    let t=null;
    window.addEventListener("resize", ()=>{ clearTimeout(t); t=setTimeout(redoLayout, 200); });
  });

})(jQuery);
</script>
</body>
</html>
